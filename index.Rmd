---
title: "Practical machine learning course project"
author: "Luigi Bernardi"
output: html_document
---

The goal of this project is to predict if Unilateral Dumbbell Biceps Curl is performed correctly using data form accelerometers on the belt, forearm, arm, and dumbell of 6 participants to the experiment. Participants were asked to perform barbell lifts correctly and incorrectly in 5 different ways:

* exactly according to the specification (Class A),
* throwing the elbows to the front (Class B),
* lifting the dumbbell only halfway (Class C),
* lowering the dumbbell only halfway (Class D)
* throwing the hips to the front (Class E).

Class A corresponds to the specified execution of the exercise, while the other 4 classes correspond to common mistakes.

More information is available from the website here:  
http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har

The training data for this project are available here:  
https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv

The test data are available here:  
https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv

The **classe** variable in training set will be the outcome and a selection from the other variables will be used for prediction.
  
In this report I'll briefly explain:

* how I built predictive model,
* how I used cross validation,
* expectation regarding out of sample error.

Finally I'll show results of my prection on the 20 cases in testing set.

## Loading and preprocessing the data

Raw data were loaded into **pml_training_raw** and **pml_testing_raw** data frames. Then I selected all variables measuring movements (identified by **x**, **y** and **z** suffix) for using them as predictors. Final training and testing sets are **pml_training** and **pml_testing**. 

```{r load, echo=TRUE, message=FALSE, cache=TRUE}
library(tidyverse)

pml_training_raw <- read.csv("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv")
pml_testing_raw <- read.csv("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv")

pml_training <- pml_training_raw %>% 
      select(classe, ends_with("_X"), ends_with("_y"), ends_with("_z"))

pml_testing <- pml_testing_raw %>% 
      select(ends_with("_X"), ends_with("_y"), ends_with("_z"))
```

## Building predictive model with cross validation

For predicting proper execution of exercise I fitted and compared two different models:  

* A **CART** model using **rpart** method and **10-fold cross validation** in train function of caret package (**pml_modfit_rpart**),
* A **random forest** model using **rpart** method and **2-fold cross validation** in train function of caret package (**pml_modfit_rf**). For this model I decided to use just a 2-fold cross validation aiming to reduce computational time if reviewers will decide to run code.

```{r fit, echo=TRUE, message=FALSE, cache=TRUE}
library(caret)

RNGversion("3.0.0")
set.seed(691979)
pml_modfit_rpart <- train(classe ~ .,
                          method = "rpart",
                          trControl = trainControl(method = "cv", number = 10),
                          data = pml_training)

RNGversion("3.0.0")
set.seed(691979)
pml_modfit_rf <- train(classe ~ .,
                       method = "rf",
                       trControl = trainControl(method = "cv", number = 2),
                       data = pml_training)
```

## Comparing models

Evaluation metrics for **pml_modfit_rpart** and **pml_modfit_rf** are reported in following figures.

```{r compare_rpart, echo=TRUE, message=TRUE, cache=TRUE}
pml_modfit_rpart
```

```{r compare_rf, echo=TRUE, message=TRUE, cache=TRUE}
pml_modfit_rf
```

Random forest model **pml_modfit_rf** is more accurate and so I decided to use it as final model for my predictions.

## Final model description

As shown in figure, **pml_modfit_rf** use 36 predictors with a training accuracy of 0.98 and a mtry (the number of variables randomly sampled as candidates at each split) equal to 2. In the following figure predictors are listed in order of importance.

```{r importance, echo=TRUE, message=TRUE, cache=TRUE}
varImp(pml_modfit_rf)
```

Figure show that for predicting the proper execution of exercise measures from magnets located on the dumbell are the most important variables.

## Expectation regarding out of sample error and predictions for test cases

Regarding to out of sample error, I'll expect it to be **greater than in sample error**. Finally I used model to predict values for the 20 test cases provided. Following figure show results of my predictions.

```{r predict, echo=TRUE, message=TRUE, cache=TRUE}
data.frame(case = 1:20,
           predicted_class = predict(pml_modfit_rf, pml_testing))
```



